{% extends 'base.html.twig' %}

{% set pagetitle = 'Programme' %}

{% block head %}
    <div class="timezone"><span class="icon-clock"></span> All times are listed in CEST (UTC+2)</div>
{% endblock %}

{% block side %}
    <div class="sticky">
    {% if is_granted('ROLE_MANAGER') %}
        <div class="admin"><h3>Maintainance <span class="icon-lock"></span></h3><ul>
        <li><a href="{{path('program_block_index')}}">Edit programme</a></li>
        </ul></div>
    {% endif %}
        <div><h3>Sessions</h3><ul>
        {% for block in program %}
            <li><a href="#{{ block.date|date('Ymd') }}{{ block.TimeStart|date('Hi') }}">{{ block }}</a></li>
        {% endfor %}
        </ul></div>
        <div>As IMDIS 2021 is online we have reduced the length of each talk. Authors have been given the option to record a longer version of their talk. If a recording is available this can be accessed through the camera icon (<span class="icon-video-camera"></span>).</div>
    </div>
{% endblock %}


{% block main %}
{% set shown = false %}
{%- for block in program %}
    {% if loop.index == 1 %}
        <div class="anchor"><a name="{{ block.date|date('Ymd') }}{{ block.TimeStart|date('Hi') }}"></a></div><table class="program">
    {% else %}
        <tr class="spacer"><td colspan="2"><a name="{{ block.date|date('Ymd') }}{{ block.TimeStart|date('Hi') }}"></a>&nbsp;</td></tr>
    {% endif %}
    <tr class="day"><td colspan="2">
        {% if is_granted('ROLE_USER') %}<div class="connect">{% if block.status == 'past' %}This session has ended{% elseif block.SessionUrl and shown==false %}<a href="{{block.SessionUrl}}"><span class="icon-link"></span> Join this session</a>{% set shown=true %}{% else %}Connection info not yet available{% endif %}</div>{% endif %}
        <h2>{{ block.date|date('l d F') }}</h2>
        <span class="time">{{ block.TimeStart|date('H:i') }}</span> - <span class="time">{{ block.TimeEnd|date('H:i') }}</span>
    </td></tr>
    {%- for session in block.session %}
        <tr class="session">
            <td colspan="2"><h3>{% if session.theme %}Session {{session.theme }}: {{session.theme.tagline}} {% else %}{{ session.title }}{% endif %}</h3>
            Chairs: {{session.chair|join(', ')}}{% if session.theme %}<br/>{{session.theme.abstracts|filter((a) => a.presentation)|length}} orals, {{session.theme.abstracts|filter((a) => a.poster)|length}} posters{% endif %}</td>
        </tr>
        {%- for talk in session.presentations %}
            {% if talk.type == 'break / end' %}
                <tr class="break"><td class="time">{{ talk.TimeStart|date('H:i') }}</td><td>{{talk.title}}</td></tr>
            {% elseif talk.type == 'posters' %}
                <tr class="postersession"><td class="time">{{ talk.TimeStart|date('H:i') }}</td><td>Poster session {{ talk.PosterSession.theme|join(' / ') }}, <nobr><a href="{{path('poster_index')}}#{{ block.date|date('Ymd') }}{{ talk.PosterSession.TimeStart|date('Hi') }}">view posters here</a></nobr></td></tr>
            {% else %}
                <tr class="talk {% if talk.type == 'keynote' %}keynote{% endif %}">
                    <td><span class="time">{{ talk.TimeStart|date('H:i') }}</span>
                        {% if talk.VideoUrl and is_granted('ROLE_USER') and block.status == 'past' %}
                            <div class="video"><a href="{{ talk.VideoUrl }}" title="Watch full presentation"><span class="icon-video-camera"></span></a></div>
                        {% endif %}
                    </td>
                    <td>
                        <span class="id">{% if talk.abstract %}{{talk.abstract.ImdisId}}{% endif %}</span>
                        <span class="title">{% if talk.abstract and talk.abstract.url %}<a href="{{talk.abstract.url}}">{{ talk.abstract.title ?? talk.title }}</a>{% else %}{{ talk.abstract.title ?? talk.title }}{% endif %}</span>
                        {# <span class="teaser">{{ talk.teaser }}</span> #}
                    <span class="authors">{% apply spaceless %}
                    {% if talk.abstract %}
                        {%- for person in talk.abstract.people %}{%- if not loop.first %}{%- if loop.last %} and {% else %}, {% endif %}{% endif %}{%- if person.isPresenter %}<span class="speaker">{%- endif %}{{ person.name }}{%- if person.isPresenter %}</span>{%- endif %}{% endfor %}
                    {% else %}
                    {%- for person in talk.presentationPeople %}
                        {%- if not loop.first %}{%- if not loop.last %}, {% else %} and {% endif %}{% endif %}
                            {%- if person.presenter %}
                                <span class="speaker">
                            {%- endif %}
                            {{ person.name }}
                            {%- if person.presenter %}
                                </span>
                            {%- endif %}
                        {% endfor %}
                    {% endif %}
                        {% endapply %}
                        </span>
                    </td>
                </div>
            {% endif %}
        {%- endfor %}
    {% endfor %}
{% endfor %}
</table>
{% endblock %}